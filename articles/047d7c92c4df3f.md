---
title: "Haskell を Dev Container で動かしたい"
emoji: "👋"
type: "tech"
topics: ["haskell", "devcontainer", "docker"]
published: false
---

:::message
Dev Container で Haskell 環境を構築しようとしたら思いのほか沼ったので，備忘録として書いておこうという趣旨の記事になります．Haskell 初心者なので誤った情報が含まれているかもしれません．もしお気づきの際は，大変恐縮ですがやさしい言葉でご指摘くださいませ．
:::

# 1. Dev Container に Haskell プリセットがない

Dev Container で Haskell 環境を構築しようとすると，おそらくまず真っ先にプリセットから Haskell を探そうとするでしょう．そしてその試みは失敗に終わります．というのも，`has` まで入力した時点で，候補が 0 件になってしまうのです．実はすこし以前にはあったようなのですが，現在では廃止されてしまったようです：

https://github.com/microsoft/vscode-dev-containers/tree/main/containers/haskell

# 2. Haskell Features だと拡張機能がうまく動作しない

Dev Container にプリセットがないとき，次に探すべきは Features です．そして幸運にも Features には Haskell がありました．これを利用すると，一応の Haskell 環境を Dev Container で構築することができます：

https://github.com/devcontainers-contrib/features/tree/main/src/haskell

しかしこれで一件落着というわけにはいきません．Visual Studio Code の Haskell 拡張機能を使おうとすると，次のような 2 つのエラーメッセージが表示されます：

```
Project requires GHCup but it isn't installed
```

```
Cannot hlint the haskell file. The hlint program was not found. Use the 'haskell.hlint.executablePath' setting to configure the location of 'hlint'
```

そうかそうか，`GHCup` と `hlint` というやつをインストールする必要があるんだね．ふむふむ．そして Haskell Feature にはオプションがあったことを思い出します．オプションは以下のとおりです：

| Options Id | Description | Type | Default Value |
|-----|-----|-----|-----|
| ghcVersion | Select the GHC (Glasgow Haskell Compiler) version to install. | string | recommended |
| cabalVersion | Select the Cabal (a system for building and packaging Haskell libraries and programs) version to install. | string | recommended |
| globalPackages | Packages to install via `cabal install`, such as `hlint` for linting. Separate with spaces. This will add significant initial build time. | string | - |
| installHLS | Install HLS, the Haskell Language Server. | boolean | true |
| downgradeGhcToSupportHls | This will downgrade GHC to the closest version supported by HLS. There is often a gap between a GHC release and tooling support. | boolean | true |
| installStack | Install Stack, a build tool for Haskell. | boolean | true |
| installStackGHCupHook | Enabling this means that stack won't install its own GHC versions, but uses GHCup's | boolean | true |
| adjustBash | whether to adjust PATH in bashrc (prepend) | boolean | true |



https://marketplace.visualstudio.com/items?itemName=haskell.haskell


https://github.com/haskell/vscode-haskell#downloaded-binaries

# 3. 公式 Docker Image だと拡張機能がうまく動作しない

Visual Studio Code
Haskell 拡張機能
