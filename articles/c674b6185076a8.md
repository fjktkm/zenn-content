---
title: "ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆã®æ©Ÿæ¢°å­¦ç¿’ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª TorchFont ã‚’ä½œã£ãŸ"
emoji: "ğŸ§ª"
type: "tech"
topics: ["pytorch", "font", "æ©Ÿæ¢°å­¦ç¿’"]
published: false
---

## 1. ã¯ã˜ã‚ã«

ãƒ•ã‚©ãƒ³ãƒˆã¯å°åˆ·ç‰©ã‚„ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã«ãŠã„ã¦æ–‡å­—æƒ…å ±ã‚’ä¼é”ã™ã‚‹ãŸã‚ã«é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¦ã„ã¾ã™ï¼ãã®åˆ¶ä½œã«ã¯å¤šãã®æ™‚é–“ã¨åŠ´åŠ›ãŒå¿…è¦ã§ã‚ã‚Šï¼Œæ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹è‡ªå‹•ç”ŸæˆãŒæœŸå¾…ã•ã‚Œã¦ã„ã¾ã™ï¼

æ—¢å­˜ã®ãƒ•ã‚©ãƒ³ãƒˆã«é–¢ã™ã‚‹æ©Ÿæ¢°å­¦ç¿’æ‰‹æ³•ã¯ï¼Œä¸»ã«ç”»åƒç”ŸæˆæŠ€è¡“ã®å¿œç”¨ã¨ã—ã¦ç™ºé”ã—ã¦ãã¾ã—ãŸï¼ä»£è¡¨çš„ãªã‚‚ã®ã¯ VAE ã‚„ GAN ã‚’ç”¨ã„ãŸæ‰‹æ³•ã§ã‚ã‚Šï¼Œã“ã‚Œã‚‰ã¯ãƒ“ãƒƒãƒˆãƒãƒƒãƒ—ãƒ•ã‚©ãƒ³ãƒˆã®ç”Ÿæˆã«æˆåŠŸã—ã¦ã„ã¾ã™ï¼ã—ã‹ã—ï¼Œãƒ•ã‚©ãƒ³ãƒˆã¯æ§˜ã€…ãªã‚¹ã‚±ãƒ¼ãƒ«ã§åˆ©ç”¨ã•ã‚Œã‚‹ãŸã‚è§£åƒåº¦ã«ä¾å­˜ã—ãªã„ãƒ™ã‚¯ã‚¿ãƒ¼å½¢å¼ãŒä¸»æµã§ã‚ã‚Šï¼Œãƒ“ãƒƒãƒˆãƒãƒƒãƒ—å½¢å¼ã§ã®ç”Ÿæˆã«ã¯å®Ÿç”¨æ€§ãŒä½ã„ã¨ã„ã†èª²é¡ŒãŒã‚ã‚Šã¾ã™ï¼

ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆã®ç”Ÿæˆã®ç ”ç©¶ãŒã‚ã¾ã‚Šé€²å±•ã—ã¦ã„ãªã„èƒŒæ™¯ã®ã²ã¨ã¤ã«ã¯ï¼Œãƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆç‰¹æœ‰ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å¯¾å¿œã—ãŸæ©Ÿæ¢°å­¦ç¿’ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¸è¶³ã—ã¦ã„ã‚‹ã“ã¨ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ï¼ãã“ã§ï¼Œã‚ãŸã—ã¯ PyTorch ãƒ™ãƒ¼ã‚¹ã®ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ç‰¹åŒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª TorchFont ã‚’é–‹ç™ºã—ã¾ã—ãŸï¼ã“ã®è¨˜äº‹ã§ã¯ï¼ŒTorchFont ã®è¨­è¨ˆç†å¿µã‚„æ©Ÿèƒ½ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ï¼

## 2. æ—¢å­˜æ‰‹æ³•

### 2.1. DeepSVG ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ

ãƒ™ã‚¯ã‚¿ãƒ¼ç”»åƒã®ç”Ÿæˆã«å–ã‚Šçµ„ã‚“ã åˆæœŸã®ç ”ç©¶ã« DeepSVG ãŒã‚ã‚Šã¾ã™ï¼DeepSVG ã§ã¯ãƒ™ã‚¯ã‚¿ãƒ¼ç”»åƒã ã‘ã§ãªããƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆã®ç”Ÿæˆã«ã‚‚å–ã‚Šçµ„ã‚“ã§ãŠã‚Šï¼Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ï¼ˆå³å¯†ã«ã¯ãã®å…ˆè¡Œç ”ç©¶ã® SVG-VAE ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã™ï¼‰ï¼

https://alexandre01.github.io/deepsvg/

https://github.com/alexandre01/deepsvg

ã“ã“ã§ï¼ŒDeepSVG ã®ãƒ•ã‚©ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨ï¼ŒGoogle Fonts ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ¯”è¼ƒã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼

|              | ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚§ã‚¤ã‚¹æ•° |   æ–‡å­—ç¨®æ•° |  ç·ã‚µãƒ³ãƒ—ãƒ«æ•° |
| :----------: | -----------------: | ---------: | ------------: |
|   DeepSVG    |             45,821 |         62 |       100,000 |
| Google Fonts |           ç´„ 9,000 | ç´„ 110,000 | ç´„ 12,000,000 |

Google Fonts ã¯ãƒ•ã‚©ãƒ³ãƒˆæ•°ã“ãå°‘ãªã„ã‚‚ã®ã®ï¼Œã‚µãƒ³ãƒ—ãƒ«æ•°ã«ãŠã„ã¦ç´„ 120 å€ã‚‚ã®å·®ãŒã‚ã‚Šã¾ã™ï¼ã¾ãŸï¼ŒDeepSVG ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯è‹±æ•°å­—ã®ã¿ã§ã‚ã‚‹ã®ã«å¯¾ã—ï¼ŒGoogle Fonts ã«ã¯ãã†ã—ãŸåˆ¶é™ãŒã‚ã‚Šã¾ã›ã‚“ï¼ç‰¹ã«æ—¥æœ¬èªã‚’å«ã‚€å¤šè¨€èªãƒ•ã‚©ãƒ³ãƒˆã®ç”Ÿæˆã‚’è€ƒãˆã‚‹ã¨ï¼ŒDeepSVG ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã¯ä¸ååˆ†ã ã¨è¨€ã‚ã–ã‚‹ã‚’å¾—ãªã„ã§ã—ã‚‡ã†ï¼

### 2.2. TTFQuery ãŠã‚ˆã³ fontTools

ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚’å–ã‚Šå‡ºã™ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ TTFQuery ãŒã‚ã‚Šã¾ã™ï¼TTFQuery ã¯ Python ã® fontTools ã‚’ãƒ©ãƒƒãƒ—ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚Šï¼Œãƒ•ã‚©ãƒ³ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã‚’ç°¡å˜ã«å–å¾—ã§ãã¾ã™ï¼

https://github.com/mcfletch/ttfquery

ãã‚‚ãã‚‚ fontTools ã¯ãƒ•ã‚©ãƒ³ãƒˆé–‹ç™ºã®ç¾å ´ã§ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹æ±ç”¨çš„ã§å¼·åŠ›ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚Šï¼Œãƒ•ã‚©ãƒ³ãƒˆã®è§£æã‚„ç·¨é›†ãªã©æ§˜ã€…ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ï¼åˆ¥ã« TTFQuery ã‚’ä½¿ç”¨ã›ãšã¨ã‚‚ï¼ŒfontTools ã‚’ç›´æ¥åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ãƒ•ã‚©ãƒ³ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼è©³ã—ãã¯ fontTools ã® Pen ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãªã©ã‚’å‚ç…§ã™ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ï¼

https://github.com/fonttools/fonttools

ä¸€æ–¹ã§ï¼ŒfontTools ã‚’ä½¿ç”¨ã—ãŸæ–¹æ³•ã«ã¯å•é¡Œç‚¹ãŒã‚ã‚Šã¾ã™ï¼å•é¡Œç‚¹ã¯å¤§ããæ¬¡ã® 2 ã¤ã§ã™ï¼

- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¤šã„
- ãƒ‘ãƒ¼ã‚µãƒ¼ã®å‡¦ç†é€Ÿåº¦ãŒé…ã„

å…·ä½“çš„ã«ã¯ï¼ŒGoogle Fonts ã«å«ã¾ã‚Œã‚‹ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€ã®ã«ï¼Œãƒ¡ãƒ¢ãƒªã‚’ 30 GB ç¨‹åº¦è¦ã—ã¾ã™ï¼ã“ã‚Œã§ãƒ‘ãƒ¼ã‚¹é€Ÿåº¦ãŒé€Ÿã‘ã‚Œã°æ¯å›ãƒ‘ãƒ¼ã‚¹ã—ã¦ã‚‚ã‚ˆã„ã®ã§ã™ãŒï¼Œå‡¦ç†é€Ÿåº¦ã‚‚é…ã„ãŸã‚ãƒ¡ãƒ¢ãƒªã«ä¿æŒã—ç¶šã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼

ã¾ãŸï¼Œãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹çµæœã¯ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã§å…±æœ‰ã§ããªã„ãŸã‚ï¼ŒPyTorch ã® Dataloader ã§ `num_workers` ã‚’å¢—ã‚„ã™å ´åˆ `num_workers` å€ã®ãƒ¡ãƒ¢ãƒªãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼ã“ã‚ŒãŒç‰¹ã«è‡´å‘½çš„ã§ï¼Œãƒã‚·ãƒ³ã®ãƒ¡ãƒ¢ãƒªå®¹é‡ãŒé™ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼ŒDataloader ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ï¼DeepSVG ãªã©ã«ãŠã„ã¦ã‚ªãƒ³ã‚¶ãƒ•ãƒ©ã‚¤ã§å‡¦ç†ã›ãšã‚ã‚‰ã‹ã˜ã‚ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã‚‚ã®ï¼Œã“ã®ã‚ãŸã‚Šã®å•é¡ŒãŒåŸå› ãªã®ã§ã¯ãªã„ã‹ã¨æ¨æ¸¬ã—ã¦ã„ã¾ã™ï¼

ã“ã‚Œã‚‰ã¯ fontTools ãŒæ±ç”¨çš„ã§ã‚ã‚‹ãŒã‚†ãˆã®å•é¡Œç‚¹ã§ fontTools ã«æ–‡å¥ã‚’è¨€ã†ã®ã¯ç­‹é•ã„ã§ã™ãŒï¼Œã¨ã¯ã„ãˆæ©Ÿæ¢°å­¦ç¿’ã®åˆ†é‡ã§ä½¿ç”¨ã™ã‚‹ã«ã¯ã‚„ã‚„ä¸å‘ããªé¢ãŒã‚ã‚‹ã“ã¨ã¯å¦ã‚ã¾ã›ã‚“ï¼

## 3. ææ¡ˆæ‰‹æ³•

### 3.1. Skrifa

ãƒ•ã‚©ãƒ³ãƒˆé–¢é€£ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ï¼Œå¤§ããæ¬¡ã® 2 ã¤ã®æ½®æµãŒã‚ã‚Šã¾ã—ãŸï¼

- FreeType ã‚„ HarfBuzz ãªã©ã® C/C++ ãƒ™ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- fontTools ãªã©ã® Python ãƒ™ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

C/C++ ãƒ™ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ï¼Œä¸»ã«ãƒ•ã‚©ãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãªã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®å‡¦ç†ã‚’æ‹…ã†ä¸€æ–¹ï¼ŒPython ãƒ™ãƒ¼ã‚¹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ãƒ•ã‚©ãƒ³ãƒˆã®ç·¨é›†ãªã©ã®ãƒ•ã‚©ãƒ³ãƒˆã®é–‹ç™ºè€…å‘ã‘ã®å‡¦ç†ã‚’æ‹…ã£ã¦ã„ã¾ã—ãŸï¼

ã“ã†ã—ãŸçŠ¶æ³ã«å¯¾ã—ã¦ï¼Œè¿‘å¹´ Python ã‚ˆã‚Šé«˜é€Ÿã§ C/C++ ã‚ˆã‚Šãƒ¡ãƒ¢ãƒªå®‰å…¨ãª Rust ã‚’ç”¨ã„ã¦ãƒªãƒ—ãƒ¬ãƒ¼ã‚¹ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒé€²ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ï¼ãã‚ŒãŒ Google Fonts ãƒãƒ¼ãƒ ã«ã‚ˆã‚‹ Oxidize ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ï¼

https://github.com/googlefonts/oxidize

ãŸã¨ãˆã°ï¼ŒChrome ã§ã¯ä»¥å‰ã¯ãƒ•ã‚©ãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã« C/C++ ãƒ™ãƒ¼ã‚¹ã® FreeType ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã—ãŸãŒï¼Œ2025 å¹´ã« Rust ãƒ™ãƒ¼ã‚¹ã® Skrifa ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸï¼

https://developer.chrome.com/blog/memory-safety-fonts?hl=ja

TorchFont ã§ã¯ï¼Œã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®å–å¾—ã« Skrifa ã‚’æ¡ç”¨ã—ã¾ã—ãŸï¼Skrifa ã¯ fontTools ã¨æ¯”è¼ƒã—ã¦ãƒ‘ãƒ¼ã‚¹é€Ÿåº¦ãŒæ¥µã‚ã¦é«˜é€Ÿã§ï¼Œãƒ‘ãƒ¼ã‚¹çµæœã‚’å¸¸ã«ãƒ¡ãƒ¢ãƒªã«ä¿æŒã—ç¶šã‘ã‚‹å¿…è¦æ€§ãŒãªããªã‚Šã¾ã—ãŸï¼

ãã®çµæœï¼Œãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒå¤§å¹…ã«å‰Šæ¸›ã•ã‚Œã¾ã—ãŸï¼å…·ä½“çš„ã«ã¯ï¼ŒfontTools ã§ã¯ Google Fonts å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚€ã®ã« 30 GB ç¨‹åº¦å¿…è¦ã ã£ãŸã®ã«å¯¾ã—ã¦ï¼ŒSkrifa ã‚’ä½¿ç”¨ã—ãŸå ´åˆã§ã¯ 2 GB ç¨‹åº¦ã¾ã§å‰Šæ¸›ã•ã‚Œã¾ã—ãŸï¼

### 3.3. Memory Mapped I/O

Skrifa ã®æ¡ç”¨ã¯ï¼Œãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã§ã®ãƒ¡ãƒ¢ãƒªå…±æœ‰ã‚’å¯èƒ½ã«ã—ãŸç‚¹ã§ã‚‚é‡è¦ã§ã™ï¼ã¨ã„ã†ã®ã‚‚ï¼ŒSkrifa ã®æ¡ç”¨ã«ã‚ˆã‚Šãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã„ã¦ã‚‚ãƒ‘ãƒ¼ã‚¹çµæœã®å…±æœ‰ã‚’è€ƒãˆã‚‹å¿…è¦ãŒãªããªã‚Šï¼Œå˜ã«ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰ã‚’è€ƒãˆã‚Œã°ã‚ˆããªã£ãŸã‹ã‚‰ã§ã™ï¼

ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰ï¼ŒMemory Mapped I/O ã§èª­ã¿è¾¼ã‚€ã“ã¨ã§ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã§ã®å…±æœ‰ã‚’ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã™ï¼ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šï¼Œãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å¢—å¤§ã‚’ä¼´ã‚ãšã« PyTorch ã® Dataloader ã® `num_workers` ã‚’å¤§ããã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼

https://crates.io/crates/memmap2

### 3.4. Maturin

TorchFont ã¯æ©Ÿæ¢°å­¦ç¿’ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ãŸã‚ï¼ŒPython ã‹ã‚‰åˆ©ç”¨ã§ãã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã§ã™ï¼ãã“ã§ï¼ŒTorchFont ã¯ Maturin ã‚’ç”¨ã„ã¦ Python ã¨ Rust ã®æ··æˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸï¼

Maturin ã¨ã¯ï¼ŒRust ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ Python ã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ï¼Maturin ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ï¼ŒRust ã§ Skrifa ã‚’åˆ©ç”¨ã—ã¦å–å¾—ã—ãŸãƒ•ã‚©ãƒ³ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã‚’ Python ã§æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã„ã†ã‚ã‘ã§ã™ï¼

https://www.maturin.rs/

## 4. ä½¿ç”¨ä¾‹

å®Ÿéš›ã«ä½œæˆã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ï¼

https://github.com/fjktkm/torchfont

TorchFont ã‚’ä½¿ç”¨ã—ã¦ï¼ŒGoogle Fonts ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã™ã‚‹ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ï¼

### 4.1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

TorchFont ã¯ PyPI ã§å…¬é–‹ã—ã¦ã„ã‚‹ãŸã‚ï¼Œ`pip` ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ï¼

```bash
pip install torchfont
```

ã¾ãŸï¼Œæœ€è¿‘ã‚·ã‚§ã‚¢ãŒæ‹¡å¤§ã—ã¦ã„ã‚‹ `uv` ã®å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ï¼

```bash
uv add torchfont
```

### 4.2. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æ§‹ç¯‰

TorchFont ã§ã¯ï¼Œã‚‚ã£ã¨ã‚‚é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹ã§ã‚ã‚ã† Google Fonts ã«ã¤ã„ã¦ç°¡å˜ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ï¼æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ PyTorch ã® Dataset ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ãŸ Google Fonts ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ§‹ç¯‰ã§ãã¾ã™ï¼

```python
from torchfont.datasets import GoogleFonts

dataset = GoogleFonts(
    root="data/google/fonts",
    ref="main",
    download=True,
)
```

`GoogleFonts` ã‚¯ãƒ©ã‚¹ã®å¼•æ•°ã«ã¯ï¼Œæ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ï¼

- `root`: Google Fonts ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- `ref`: ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒã‚„ã‚¿ã‚°
- `patterns`: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ä½¿ç”¨ã™ã‚‹ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³
- `codepoint_filter`: ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã«ä½¿ç”¨ã™ã‚‹æ–‡å­—ã® Unicode ã®ãƒªã‚¹ãƒˆ
- `transform`: å–ã‚Šå‡ºã—ãŸã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã«å¯¾ã—ã¦é©ç”¨ã™ã‚‹å¤‰æ›é–¢æ•°
- `download`: Google Fonts ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã‹ã©ã†ã‹

### 4.3. ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã®å–å¾—

ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ§‹ç¯‰ã—ãŸã‚‰ï¼Œã‚ã¨ã¯ PyTorch ã®é€šå¸¸ã® Dataset ã¨åŒæ§˜ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã ã‘ã§ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ï¼æ¬¡ã«ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼

```python
types, coords, style_label, content_label = dataset[42]

print(f"{types=}")
print(f"{coords=}")
print(f"{style_label=}")
print(f"{content_label=}")
```

ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®è¿”ã‚Šå€¤ã¯ï¼Œæ¬¡ã® 4 ã¤ã®è¦ç´ ã‹ã‚‰ãªã‚‹ã‚¿ãƒ—ãƒ«ã¨ãªã‚Šã¾ã™ï¼ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œçµæœã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼

```python
types=tensor([1, 3, 3, 3, 3, 2, 3, 3, 3, 3, 2, 2, 4, 5])
coords=tensor([[ 0.0000,  0.0000,  0.0000,  0.0000,  0.2759,  0.2207],
        [ 0.2759,  0.1755,  0.2701,  0.1295,  0.2585,  0.0828],
        [ 0.2470,  0.0361,  0.2309, -0.0092,  0.2102, -0.0530],
        [ 0.1895, -0.0968,  0.1647, -0.1377,  0.1357, -0.1758],
        [ 0.1068, -0.2139,  0.0749, -0.2471,  0.0400, -0.2754],
        [ 0.0000,  0.0000,  0.0000,  0.0000, -0.0352, -0.2300],
        [-0.0156, -0.2033,  0.0015, -0.1730,  0.0161, -0.1392],
        [ 0.0308, -0.1053,  0.0430, -0.0701,  0.0527, -0.0337],
        [ 0.0625,  0.0028,  0.0698,  0.0394,  0.0747,  0.0762],
        [ 0.0796,  0.1130,  0.0820,  0.1479,  0.0820,  0.1812],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0820,  0.7031],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.2759,  0.7031],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000],
        [ 0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000]])
style_label=0
content_label=74
```

`types` ã¯æç”»ã‚³ãƒãƒ³ãƒ‰ã®ç¨®é¡ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹ãƒ©ãƒ™ãƒ«ã®ãƒ†ãƒ³ã‚½ãƒ«ã§ã™ï¼`0` ã‹ã‚‰ `5` ã¾ã§ã®æ•´æ•°å€¤ã‚’ã¨ã‚Šï¼Œãã‚Œãã‚Œæ¬¡ã®æç”»ã‚³ãƒãƒ³ãƒ‰ã‚’è¡¨ã—ã¾ã™ï¼

| ã‚¯ãƒ©ã‚¹ãƒ©ãƒ™ãƒ« | æç”»ã‚³ãƒãƒ³ãƒ‰ |
| :---: | :---: |
| 0 | `PAD` |
| 1 | `MoveTo` |
| 2 | `LineTo` |
| 3 | `CurveTo` |
| 4 | `ClosePath` |
| 5 | `EOS` |

`coords` ã¯æç”»ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã«ã‚ãŸã‚‹åˆ¶å¾¡ç‚¹ã¨çµ‚ç‚¹ã®åº§æ¨™ã‚’è¡¨ã™ãƒ†ãƒ³ã‚½ãƒ«ã§ã™ï¼`MoveTo` ã¨ `LineTo` ã®å ´åˆã¯çµ‚ç‚¹ã®ã¿ã§ 2 æ¬¡å…ƒï¼Œ`CurveTo` ã®å ´åˆã¯åˆ¶å¾¡ç‚¹ãŒ 2 ã¤ã¨çµ‚ç‚¹ãŒã‚ã‚‹ãŸã‚ 6 æ¬¡å…ƒï¼Œãã®ä»–ã¯å¼•æ•°ã‚’æŒã¡ã¾ã›ã‚“ï¼æœ€å¤§ã® 6 æ¬¡å…ƒã«åˆã‚ã›ã¦ãƒ†ãƒ³ã‚½ãƒ«ãŒæ§‹æˆã•ã‚Œã¦ãŠã‚Šï¼Œé–¢ä¿‚ã®ãªã„éƒ¨åˆ†ã¯ã™ã¹ã¦ 0 åŸ‹ã‚ã•ã‚Œã¦ã„ã¾ã™ï¼

`style_label` ã¯ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚§ã‚¤ã‚¹ã®ã‚¯ãƒ©ã‚¹ã‚’è¡¨ã™æ•´æ•°å€¤ï¼Œ`content_label` ã¯æ–‡å­—ç¨®ã®ã‚¯ãƒ©ã‚¹ã‚’è¡¨ã™æ•´æ•°å€¤ã§ã™ï¼ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã„ã† 2 ã¤ã®ãƒ©ãƒ™ãƒ«ãŒã‚ã‚‹ç‚¹ãŒãƒ•ã‚©ãƒ³ãƒˆã¨ã„ã†ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç‰¹å¾´çš„ãªç‚¹ã ã¨è¨€ãˆã¾ã™ï¼ã©ã¡ã‚‰ã‚‚ 0 ã‹ã‚‰å§‹ã¾ã‚‹é€£ç•ªã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ï¼ãŸã¨ãˆã° `content_label` ã¯ Unicode ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã¯ä¸€è‡´ã—ã¾ã›ã‚“ï¼

### 4.4. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æƒ…å ±å–å¾—

PyTorch ã‚„ TorchVision ã®æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨åŒã˜ã‚ˆã†ãªä½¿ã„å¿ƒåœ°ãŒå®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ï¼Œãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¯ãƒ©ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®é•·ã•ã‚„ã‚¯ãƒ©ã‚¹ãƒ©ãƒ™ãƒ«ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ï¼ä»¥ä¸‹ã«ä¾‹ã‚’ç¤ºã—ã¾ã™ï¼

```python
print(f"{len(dataset)=}")
print(f"{len(dataset.content_classes)=}")
print(f"{len(dataset.style_classes)=}")

print(f"{dataset.style_classes[0:2]=}")
print(f"{dataset.content_classes[42:58]=}")
```

å®Ÿè¡Œçµæœã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼

```python
len(dataset)=12076302
len(dataset.content_classes)=113545
len(dataset.style_classes)=8772
dataset.style_classes[0:2]=['Aclonica Regular', 'Arimo Italic Italic']
dataset.content_classes[42:58]=['*', '+', ',', '-', '.', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
```

ã“ã®ã‚ˆã†ã«ï¼Œã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚§ã‚¤ã‚¹åã‚„æ–‡å­—ç¨®ã®æƒ…å ±ã‚’ç°¡å˜ã«ç´ å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼

### 4.5. `DataLoader` ã«ã‚ˆã‚‹ãƒãƒƒãƒå‡¦ç†

TorchFont ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ PyTorch ã® Dataset ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ãŸã‚ï¼Œé€šå¸¸ã® Dataset ã¨åŒæ§˜ã« `DataLoader` ã«æ¸¡ã—ã¦ãƒãƒƒãƒå‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼

`types` ã¨ `coords` ã¯æç”»ã‚³ãƒãƒ³ãƒ‰ã¨å¯¾å¿œã™ã‚‹å¯å¤‰é•·ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§ã‚ã‚‹ãŸã‚ï¼Œ`collate_fn` ã§ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ãã®ãŸã‚ï¼Œãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆãªã©ã¨åŒæ§˜ã« `collate_fn` ã§ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼

```python
from torch.nn.utils.rnn import pad_sequence

def collate_fn(
    batch: Sequence[tuple[Tensor, Tensor, int, int]],
) -> tuple[Tensor, Tensor, Tensor, Tensor]:
    types_list = [types for types, _, _, _ in batch]
    coords_list = [coords for _, coords, _, _ in batch]
    style_label_list = [style for _, _, style, _ in batch]
    content_label_list = [content for _, _, _, content in batch]

    types_tensor = pad_sequence(types_list, batch_first=True, padding_value=0)
    coords_tensor = pad_sequence(coords_list, batch_first=True, padding_value=0.0)

    style_label_tensor = torch.as_tensor(style_label_list, dtype=torch.long)
    content_label_tensor = torch.as_tensor(content_label_list, dtype=torch.long)

    return types_tensor, coords_tensor, style_label_tensor, content_label_tensor
```

ã“ã®ã‚ˆã†ãª `collate_fn` ã‚’ç”¨ã„ã¦ `DataLoader` ã‚’æ§‹ç¯‰ã—ã¾ã™ï¼ãŸã¨ãˆã°ï¼Œæ¬¡ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã¨ãƒãƒƒãƒã‚µã‚¤ã‚º 64ï¼Œãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹æ•° 8 ã§ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼

```python
from tqdm import tqdm
from torch.utils.data import DataLoader

dataloader = DataLoader(
    dataset,
    batch_size=64,
    shuffle=True,
    num_workers=8,
    prefetch_factor=2,
    collate_fn=collate_fn,
)

for batch in tqdm(dataloader, desc="Iterating over datasets"):
    sample = batch
```

ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ï¼ŒGoogle Fonts ã‚’é«˜é€Ÿã«èª­ã¿è¾¼ã‚€æ§˜å­ãŒç¢ºèªã§ãã‚‹ã¨æ€ã„ã¾ã™ï¼ã‚ªãƒ³ã‚¶ãƒ•ãƒ©ã‚¤ã§ã“ã“ã¾ã§é«˜é€Ÿã‹ã¤å°ã•ã„ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã§ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ•ã‚©ãƒ³ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã»ã‹ã«å­˜åœ¨ã—ãªã„ã¨æ€ã„ã¾ã™ï¼

### 4.6. ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æ§‹ç¯‰

TorchFont ã§ã¯ï¼ŒGoogle Fonts ä»¥å¤–ã®ãƒ•ã‚©ãƒ³ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚‚ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«æ±ç”¨çš„ãª `FontRepo` ã‚¯ãƒ©ã‚¹ã‚‚ç”¨æ„ã—ã¦ã„ã¾ã™ï¼

ãŸã¨ãˆã° Material Design Icons ã‚„ Font Awesome ã¯ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ã§ã™ãŒï¼Œå®Ÿã¯ã“ã‚Œã‚‰ã® GitHub ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ãƒ•ã‚©ãƒ³ãƒˆå½¢å¼ã«ã—ãŸã‚‚ã®ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ï¼ãã®ãŸã‚ï¼Œ`FontRepo` ã‚¯ãƒ©ã‚¹ã‚’ç”¨ã„ã¦ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ï¼

ãŸã¨ãˆã°ï¼ŒGoogle ã® Material Design Icons ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯æ¬¡ã®ã‚ˆã†ã«æ§‹ç¯‰ã§ãã¾ã™ï¼

```python
dataset = FontRepo(
    root="data/google/material_design_icons",
    url="https://github.com/google/material-design-icons",
    ref="master",
    patterns=("variablefont/*.ttf",),
    download=True,
)
```

ã¾ãŸï¼ŒFont Awesome ã®ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯æ¬¡ã®ã‚ˆã†ã«æ§‹ç¯‰ã§ãã¾ã™ï¼

```python
dataset = FontRepo(
    root="data/fortawesome/font-awesome",
    url="https://github.com/FortAwesome/Font-Awesome",
    ref="7.x",
    patterns=("otfs/*.otf",),
    download=True,
)
```

å®‰æ˜“ã« `numpy` ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã«å¤‰æ›ã—ã¦ã—ã¾ã‚ãšï¼Œãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿å½¢å¼ã«ã“ã ã‚ã£ãŸã“ã¨ã®å¨åŠ›ãŒï¼Œã“ã“ã§ç™ºæ®ã•ã‚Œã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ï¼
